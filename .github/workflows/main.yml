名字: 蜘蛛

在:
  workflow_dispatch:

工作:
建筑:

    runs-on: ubuntu-latest

步骤:
    - 用途: actions/checkout@v4
    - 名字: 设置JDK
用途: actions/setup-java@v4
与:
        java-version: '18'
分布: 'temurin'
        
query为空名字: 删除工作流程
用途: Mattraks/delete-workflow-runs@v2
与:
代币: ${{ github.token }}
仓库: ${{ github.repository }}
        retain_days: 0 
        #用于与每个工作流的保留天数进行比较的天数。
        keep_minimum_runs: 2 
        #每个工作流的最小运行次数。
        
    - 名字: 克隆项目
跑: |
rm -rf jar/custom_spider.jar
git clone --recurse-submodules https://github.com/lushunming/AndroidCatVodSpider project
sed -i 's/mirrors.cloud.tencent.com\gradle/services.gradle.org\/distributions/g' project/gradle/wrapper/gradle-wrapper.properties
      
    - 名字: 自定义蜘蛛
      working-directory: ./project
跑: |  
         #删除垃圾爬虫
#rm -rf app/src/main/java/com/github/catvod/spider/Ali.java
rm -rf app/src/main/java/com/github/catvod/spider/Dm84.java
rm -rf app/src/main/java/com/github/catvod/spider/Doll.java
rm -rf app/src/main/java/com/github/catvod/spider/Eighteen.java
rm -rf app/src/main/java/com/github/catvod/spider/Hanime.java
rm -rf app/src/main/java/com/github/catvod/spider/JSDemo.java
rm -rf app/src/main/java/com/github/catvod/spider/Jable.java
rm -rf app/src/main/java/com/github/catvod/spider/Jianpian.java
rm -rf app/src/main/java/com/github/catvod/spider/Kanqiu.java
rm -rf app/src/main/java/com/github/catvod/spider/Miss.java
rm -rf app/src/main/java/com/github/catvod/spider/Notice.java
rm -rf app/src/main/java/com/github/catvod/spider/PanSearch.java
rm -rf app/src/main/java/com/github/catvod/spider/PanSou.java
rm -rf app/src/main/java/com/github/catvod/spider/Star.java
rm -rf app/src/main/java/com/github/catvod/spider/UpYun.java
#rm -rf app/src/main/java/com/github/catvod/spider/Wogg.java
rm -rf app/src/main/java/com/github/catvod/spider/XiaoZhiTiao.java
rm -rf app/src/main/java/com/github/catvod/spider/YiSo.java
rm -rf app/src/main/java/com/github/catvod/spider/Ysj.java
rm -rf app/src/main/java/com/github/catvod/spider/Zhaozy.java

         #删除阿里云盘
#rm -rf app/src/main/java/com/github/catvod/api
#rm -rf app/src/main/java/com/github/catvod/bean/ali
#rm -rf app/src/main/java/com/github/catvod/bean/upyun

#sed -i "22,31d" app/src/main/java/com/github/catvod/spider/Push.java
#sed-i"/ali.player/c返回null；"app/src/main/java/com/github/catvod/spider/Push.java
#sed -i "/ali.detail/d" app/src/main/java/com/github/catvod/spider/Push.java
#sed -i "/\"ali\"/d;/return Ali/d" app/src/main/java/com/github/catvod/spider/Proxy.java
         
         #删除Doll残留
sed -i "/Doll/d" app/src/main/java/com/github/catvod/debug/MainActivity.java

    - 名字: 造罐子
      working-directory: ./project
跑: |
chmod +x gradlew
cat app/src/main/java/com/github/catvod/spider/Push.java
./gradlew assemblerelease --build-cache --parallel --daemon --warning-mode all
         
    - 名字: 自定义蜘蛛罐
      working-directory: ./project
跑: |        
rm -rf jar/custom_spider.jar
rm -rf jar/spider.jar/original/META-INF
curl-L https：//github. com/ibtopeaches/Apktool/releases/下载/v2. 7.0/Apktool_2.7. 0. jar>jar/3rd/Apktool_2.7. 0. jar
java -jar jar/3rd/baksmali-2.5.2.jar d app/build/intermediates/dex/release/minifyReleaseWithR8/classes.dex -o jar/Smali_classes
mkdir -p jar/spider.jar/smali/com/github/catvod/
mv jar/Smali_classes/com/github/catvod/spider jar/spider.jar/smali/com/github/catvod/
java -jar jar/3rd/apktool_2.7.0.jar b jar/spider.jar -c
mv jar/spider.jar/dist/dex.jar ../jar/custom_spider.jar
#md5=($(md5sum ../jar/custom_spider.jar))
echo $(md5sum ../jar/custom_spider.jar | awk '{print $1}') > ../jar/custom_spider.jar.md5
         
    - 名字: 上载APK
用途: actions/upload-artifact@main
与:
名字: 蜘蛛
路径: ./jar/custom_spider.jar

    - 名字: 更新蜘蛛罐
用途: EndBug/add-and-commit@v9.1.3
与:
        default_author: github_actions
消息: “更新蜘蛛罐”
增加: "['./jar/custom_spider.jar', './jar/custom_spider.jar.md5']"
